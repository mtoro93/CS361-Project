{"changed":false,"filter":false,"title":"advancedSearch.php","tooltip":"/advancedSearch.php","value":"<?php\nrequire 'commonFuncs.php'; \n$pdo = connect_db_pdo();\n?>\n\n\n\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Advanced Search</title>\n        <link rel='stylesheet' type='text/css' href='style.css' />\n    </head>\n    <body>\n        <?php\n        generate_nav_links();\n        ?>\n        <div style=\"float:right;\">\n\t        <p>Welcome user!</p>\n        </div>\n        <div class=\"middleContent\">\n            <fieldset class=\"searchForm\">\n                <legend>Search for an opportunity</legend>\n                <form class=\"advancedSearchForm\" action=\"advancedSearch.php\" method=\"post\">\n                    <?php\n                        if(!(empty($_POST['query']))){\n                            echo '<input type=\"text\" name=\"query\" placeholder=\"' . $_POST['query'] . '\" class=\"searchField\"/>';\n                        }\n                        else{\n                            echo '<input type=\"text\" name=\"query\" placeholder=\"Job title, keywords, organization...\" class=\"searchField\"/>';\n                        }\n                        \n                        if(!(empty($_POST['locquery']))){\n                            echo '<input type=\"text\" name=\"locquery\" placeholder=\"' . $_POST['locquery'] . '\" class=\"searchField\"/><br>';\n                        }\n                        else{\n                            echo '<input type=\"text\" name=\"locquery\" placeholder=\"City, state, zip code...\" class=\"searchField\"/><br>';\n                        }\n                        \n                        if(!(empty($_POST['remotequery']))){\n                            echo '<br><input type=\"checkbox\" name=\"remotequery\" value=\"yes\" checked>Remote opportunities only?<br>';\n                        }\n                        else{\n                            echo '<br><input type=\"checkbox\" name=\"remotequery\" value=\"yes\">Remote opportunities only?<br>';\n                        }\n                        \n                        if(!(empty($_POST['start']))){\n                            echo '<p>Earliest Start Date: <input type=\"date\" name=\"start\" value=\"' . $_POST['start'] . '\"/></p>';\n                        }\n                        else{\n                            echo '<p>Earliest Start Date: <input type=\"date\" name=\"start\" /></p>';\n                        }\n                    ?>\n                    <input type=\"submit\" name=\"submit\" value=\"Search\" class=\"searchButton\"/>\n                </form>\n            </fieldset>\n        \n\n        <fieldset class=\"resultsBox\">\n        <?php\n        $qry = \"SELECT oppTitle, oppDescription, oppCity, oppState, oppZip, oppRemote, oppStart FROM opportunities WHERE opportunities.id IS NOT NULL \";\n        \n        if(!(empty($_POST['query']))){\n            $qry .= \"AND (MATCH opportunities.oppTitle AGAINST (:searchQry1) \";\n            $qry .= \"OR MATCH opportunities.oppField AGAINST (:searchQry2) \";\n            $qry .= \"OR MATCH opportunities.oppDescription AGAINST (:searchQry3)) \";\n        }\n        if(!(empty($_POST['locquery']))){\n            $qry .= \"AND (MATCH opportunities.oppCity AGAINST (:locQry1) \";\n            $qry .= \"OR MATCH opportunities.oppState AGAINST (:locQry2) \";\n            $qry .= \"OR opportunities.oppZip = (:locQry3)) \";\n        }\n        \n        if(!(empty($_POST['remotequery']))){\n            $qry .= \"AND opportunities.oppRemote = 'yes' \";\n        }\n        \n        if(!(empty($_POST['start']))){\n            $qry .= \"AND opportunities.oppStart >= (:dateQry) \";\n        }\n        \n        $stmt = $pdo->prepare($qry);\n        \n        if(!(empty($_POST['query']))){\n            $stmt->bindParam(':searchQry1', $_POST['query']);\n            $stmt->bindParam(':searchQry2', $_POST['query']);\n            $stmt->bindParam(':searchQry3', $_POST['query']);\n        }\n        if(!(empty($_POST['locquery']))){\n            $stmt->bindParam(':locQry1', $_POST['locquery']);\n            $stmt->bindParam(':locQry2', $_POST['locquery']);\n            $stmt->bindParam(':locQry3', $_POST['locquery']);\n        }\n        if(!(empty($_POST['start']))){\n            $stmt->bindParam(':dateQry', $_POST['start']);\n        }\n        \n        $stmt->execute();\n        \n        echo \"<div class='resultCount'>\" . $stmt->rowCount() . \" results found.</div><br />\";\n        \n        while($row = $stmt->fetch(PDO::FETCH_ASSOC)){\n            echo '<fieldset class=\"opportunityBox\">' . '<div class=\"oppTitle\">' . $row['oppTitle'] . '</div>' \n            . '<div class=\"oppDescription\">' . $row['oppDescription'] . '</div>'\n            .  '<div class=\"oppLocation\">' . '<b>Location: </b>'. $row['oppCity'] . ', ' . $row['oppState'] . ', ' . $row['oppZip']\n            .  '</div>' . '<div class=\"oppRemoteInfo\">' . '<b>Remote: </b>' . $row['oppRemote'] . '</div>' \n            .  '<div><b>Start Date: </b>' . $row['oppStart'] . '</div>' \n            .  '<div class=\"oppApplyButton\"><button type=\"button\">Apply</button></div>'\n            . '</fieldset>';\n        }\n        ?>\n        </fieldset>\n        \n        \n         </div>\n    </body>\n</html>\n\n\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":563.5,"scrollleft":0,"selection":{"start":{"row":45,"column":24},"end":{"row":45,"column":24},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":36,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1511919992636}